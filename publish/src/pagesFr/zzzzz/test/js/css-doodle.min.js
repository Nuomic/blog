"use strict";

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }

function isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }

function _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest(); }

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance"); }

function _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === "[object Arguments]")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

!function (e) {
  "function" == typeof define && define.amd ? define(e) : e();
}(function () {
  "use strict";

  function e(e) {
    var t = 0,
        n = 1,
        r = 1;
    return {
      curr: function curr() {
        var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
        return e[t + n];
      },
      end: function end() {
        return e.length <= t;
      },
      info: function info() {
        return {
          index: t,
          col: n,
          line: r
        };
      },
      index: function index(e) {
        return void 0 === e ? t : t = e;
      },
      next: function next() {
        var s = e[t++];
        return "\n" == s ? (r++, n = 0) : n++, s;
      }
    };
  }

  function t(t) {
    t = t.trim();
    var n = [];
    if (!/^var\(/.test(t)) return n;
    var r = e(t);

    try {
      n = function (e) {
        var t = "",
            n = [],
            r = [],
            s = {};

        for (; !e.end();) {
          var _i = e.curr();

          if ("(" == _i) n.push(_i), t = "";else if (")" == _i || "," == _i) {
            if (/^\-\-.+/.test(t) && (s.name ? (s.alternative || (s.alternative = []), s.alternative.push({
              name: t
            })) : s.name = t), ")" == _i) {
              if ("(" != n[n.length - 1]) throw new Error("bad match");
              n.pop();
            }

            "," == _i && (n.length || (r.push(s), s = {})), t = "";
          } else /\s/.test(_i) || (t += _i);
          e.next();
        }

        return n.length ? [] : (s.name && r.push(s), r);
      }(r);
    } catch (e) {
      console.error(e && e.message || "Bad variables.");
    }

    return n;
  }

  function n(e) {
    return Array.isArray(e) ? e : [e];
  }

  function r(e) {
    var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "\n";
    return (e || []).join(t);
  }

  function s(e) {
    return e[e.length - 1];
  }

  function i(e) {
    return e[0];
  }

  function l(e, t) {
    return Array.prototype.flatMap ? e.flatMap(t) : e.reduce(function (e, n) {
      return e.concat(t(n));
    }, []);
  }

  var u = {
    func: function func() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      return {
        type: "func",
        name: e,
        arguments: []
      };
    },
    argument: function argument() {
      return {
        type: "argument",
        value: []
      };
    },
    text: function text() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      return {
        type: "text",
        value: e
      };
    },
    pseudo: function pseudo() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      return {
        type: "pseudo",
        selector: e,
        styles: []
      };
    },
    cond: function cond() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      return {
        type: "cond",
        name: e,
        styles: [],
        arguments: []
      };
    },
    rule: function rule() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      return {
        type: "rule",
        property: e,
        value: []
      };
    },
    keyframes: function keyframes() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      return {
        type: "keyframes",
        name: e,
        steps: []
      };
    },
    step: function step() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      return {
        type: "step",
        name: e,
        styles: []
      };
    }
  },
      o = {
    white_space: function white_space(e) {
      return /[\s\n\t]/.test(e);
    },
    line_break: function line_break(e) {
      return /\n/.test(e);
    },
    number: function number(e) {
      return !isNaN(e);
    },
    pair: function pair(e) {
      return ['"', "(", ")", "'"].includes(e);
    },
    pair_of: function pair_of(e, t) {
      return {
        '"': '"',
        "'": "'",
        "(": ")"
      }[e] == t;
    }
  };

  function a(e, _ref) {
    var t = _ref.col,
        n = _ref.line;
    console.error("(at line ".concat(n, ", column ").concat(t, ") ").concat(e));
  }

  function c(e) {
    return function (t, n) {
      var r = t.index(),
          s = "";

      for (; !t.end();) {
        var _n = t.next();

        if (e(_n)) break;
        s += _n;
      }

      return n && t.index(r), s;
    };
  }

  function p(e, t) {
    return c(function (e) {
      return /[^\w@]/.test(e);
    })(e, t);
  }

  function h(e) {
    return c(function (e) {
      return /[\s\{]/.test(e);
    })(e);
  }

  function f(e, t) {
    return c(function (e) {
      return o.line_break(e) || "{" == e;
    })(e, t);
  }

  function d(e, t) {
    var n,
        r = u.step();

    for (; !e.end() && "}" != (n = e.curr());) {
      if (o.white_space(n)) e.next();else {
        if (r.name.length) {
          if (r.styles.push(j(e, t)), "}" == e.curr()) break;
        } else r.name = k(e);

        e.next();
      }
    }

    return r;
  }

  function g(e, t) {
    var n = [];
    var r;

    for (; !e.end() && "}" != (r = e.curr());) {
      o.white_space(r) ? e.next() : (n.push(d(e, t)), e.next());
    }

    return n;
  }

  function m(e, t) {
    var n,
        r = u.keyframes();

    for (; !e.end() && "}" != (n = e.curr());) {
      if (r.name.length) {
        if ("{" == n) {
          e.next(), r.steps = g(e, t);
          break;
        }

        e.next();
      } else if (p(e), r.name = h(e), !r.name.length) {
        a("missing keyframes name", e.info());
        break;
      }
    }

    return r;
  }

  function y(e) {
    var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    for (e.next(); !e.end();) {
      var _n2 = e.curr();

      if (t.inline) {
        if ("\n" == _n2) break;
      } else if ("*" == (_n2 = e.curr()) && "/" == e.curr(1)) break;

      e.next();
    }

    t.inline || (e.next(), e.next());
  }

  function v(e) {
    var t,
        n = "";

    for (; !e.end() && ":" != (t = e.curr());) {
      o.white_space(t) || (n += t), e.next();
    }

    return n;
  }

  function x(e) {
    var t,
        n = [],
        r = [],
        i = [],
        l = "";

    for (; !e.end();) {
      if (t = e.curr(), /[\('"`]/.test(t) && "\\" !== e.curr(-1)) i.length && "(" != t && t === s(i) ? i.pop() : i.push(t), l += t;else if ("@" == t) r.length || (l = l.trimLeft()), l.length && (r.push(u.text(l)), l = ""), r.push(b(e));else if (/[,)]/.test(t)) {
        var _ref2;

        if (i.length) ")" == t && i.pop(), l += t;else if (l.length && (r.length ? l.length && r.push(u.text(l)) : r.push(u.text((a = l).trim().length ? o.number(+a) ? +a : a.trim() : a))), n.push(_(r)), (_ref2 = [[], ""], r = _ref2[0], l = _ref2[1], _ref2), ")" == t) break;
      } else l += t;
      e.next();
    }

    var a;
    return n;
  }

  function _(e) {
    var t = e.map(function (e) {
      if ("text" == e.type && "string" == typeof e.value) {
        var _t = String(e.value);

        _t.includes("`") && (e.value = _t = _t.replace(/`/g, '"')), e.value = _t.replace(/\n+|\s+/g, " ");
      }

      return e;
    }),
        n = i(t) || {},
        r = s(t) || {};

    if ("text" == n.type && "text" == r.type) {
      var _e2 = i(n.value),
          _t2 = s(r.value);

      "string" == typeof n.value && "string" == typeof r.value && o.pair(_e2) && o.pair_of(_e2, _t2) && (n.value = n.value.slice(1), r.value = r.value.slice(0, r.value.length - 1));
    }

    return t;
  }

  function b(e) {
    var t,
        n = u.func(),
        r = "";

    for (; !e.end() && ")" != (t = e.curr());) {
      if ("(" == t) {
        e.next(), n.name = r, n.arguments = x(e), n.position = e.info().index;
        break;
      }

      r += t, e.next();
    }

    return n;
  }

  function $(e) {
    var t,
        n = u.text(),
        r = 0,
        s = !0;
    var i = [],
        l = [];

    for (i[r] = []; !e.end();) {
      if (t = e.curr(), s && o.white_space(t)) e.next();else {
        if (s = !1, "\n" != t || o.white_space(e.curr(-1))) {
          if ("," != t || l.length) {
            if (/[;}]/.test(t)) {
              n.value.length && (i[r].push(n), n = u.text());
              break;
            }

            "@" == t ? (n.value.length && (i[r].push(n), n = u.text()), i[r].push(b(e))) : o.white_space(t) && o.white_space(e.curr(-1)) || ("(" == t && l.push(t), ")" == t && l.pop(), n.value += t);
          } else n.value.length && (i[r].push(n), n = u.text()), i[++r] = [], s = !0;
        } else n.value += " ";
        e.next();
      }
    }

    return n.value.length && i[r].push(n), i;
  }

  function k(e) {
    var t,
        n = "";

    for (; !e.end() && "{" != (t = e.curr());) {
      o.white_space(t) || (n += t), e.next();
    }

    return n;
  }

  function w(e) {
    var t,
        n = {
      name: "",
      arguments: []
    };

    for (; !e.end();) {
      if ("(" == (t = e.curr())) e.next(), n.arguments = x(e);else {
        if (/[){]/.test(t)) break;
        o.white_space(t) || (n.name += t);
      }
      e.next();
    }

    return n;
  }

  function z(e, t) {
    var n,
        r = u.pseudo();

    for (; !e.end() && "}" != (n = e.curr());) {
      if (o.white_space(n)) e.next();else {
        if (r.selector) {
          var _n3 = j(e, t);

          if ("@use" == _n3.property ? r.styles = r.styles.concat(_n3.value) : r.styles.push(_n3), "}" == e.curr()) break;
        } else r.selector = k(e);

        e.next();
      }
    }

    return r;
  }

  function j(e, t) {
    var n,
        r = u.rule();

    for (; !e.end() && ";" != (n = e.curr());) {
      if (r.property.length) {
        r.value = $(e);
        break;
      }

      if (r.property = v(e), "@use" == r.property) {
        r.value = S(e, t);
        break;
      }

      e.next();
    }

    return r;
  }

  function A(e, t) {
    var n,
        r = u.cond();

    for (; !e.end() && "}" != (n = e.curr());) {
      if (r.name.length) {
        if (":" == n) {
          var _t3 = z(e);

          _t3.selector && r.styles.push(_t3);
        } else if ("@" != n || f(e, !0).includes(":")) {
          if (!o.white_space(n)) {
            var _n4 = j(e, t);

            if (_n4.property && r.styles.push(_n4), "}" == e.curr()) break;
          }
        } else r.styles.push(A(e));
      } else Object.assign(r, w(e));
      e.next();
    }

    return r;
  }

  function M(e, t) {
    var n = "";
    return e && e.get_custom_property_value && (n = e.get_custom_property_value(t)), n;
  }

  function S(e, n) {
    return e.next(), ($(e) || []).reduce(function (e, r) {
      !function e(n, r) {
        n.forEach && n.forEach(function (n) {
          if ("text" == n.type && n.value) {
            var _e3 = t(n.value);

            n.value = _e3.reduce(function (e, t) {
              var n,
                  s = "",
                  i = "";
              !(s = M(r, t.name)) && t.alternative && t.alternative.every(function (e) {
                if (i = M(r, e.name)) return s = i, !1;
              });

              try {
                n = E(s, r);
              } catch (e) {}

              return n && e.push.apply(e, n), e;
            }, []);
          }

          "func" == n.type && n.arguments && n.arguments.forEach(function (t) {
            e(t, r);
          });
        });
      }(r, n);

      var _r = _slicedToArray(r, 1),
          s = _r[0];

      return s.value && s.value.length && e.push.apply(e, _toConsumableArray(s.value)), e;
    }, []);
  }

  function E(t, n) {
    var r = e(t),
        s = [];

    for (; !r.end();) {
      var _e4 = r.curr();

      if (o.white_space(_e4)) r.next();else {
        if ("/" == _e4 && "*" == r.curr(1)) y(r);else if ("/" == _e4 && "/" == r.curr(1)) y(r, {
          inline: !0
        });else if (":" == _e4) {
          var _e5 = z(r, n);

          _e5.selector && s.push(_e5);
        } else if ("@" == _e4 && "@keyframes" === p(r, !0)) {
          var _e6 = m(r, n);

          s.push(_e6);
        } else if ("@" != _e4 || f(r, !0).includes(":")) {
          if (!o.white_space(_e4)) {
            var _e7 = j(r, n);

            _e7.property && s.push(_e7);
          }
        } else {
          var _e8 = A(r, n);

          _e8.name.length && s.push(_e8);
        }
        r.next();
      }
    }

    return s;
  }

  function C(e) {
    for (var _len = arguments.length, t = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      t[_key - 1] = arguments[_key];
    }

    return t.reduce(function (e, t) {
      return e.apply(null, n(t));
    }, e);
  }

  function O(e, t, n) {
    return Math.max(t, Math.min(n, e));
  }

  function L(e, t, n) {
    var _ref3;

    var r = 0,
        s = e,
        i = function i(e) {
      return e > 0 && e < 1 ? .1 : 1;
    },
        l = arguments.length;

    1 == l && (_ref3 = [i(e), e], e = _ref3[0], t = _ref3[1], _ref3), l < 3 && (n = i(e));
    var u = [];

    for (; (n >= 0 && e <= t || n < 0 && e > t) && (u.push(e), e += n, !(r++ >= 1e3));) {
      ;
    }

    return u.length || u.push(s), u;
  }

  function T(e) {
    return /^[a-zA-Z]$/.test(e);
  }

  function H(e) {
    var t = function t() {
      return e;
    };

    return t.lazy = !0, t;
  }

  function N(e, t) {
    var n = [];

    for (var _r2 = 0; _r2 < e; ++_r2) {
      n.push(t(_r2));
    }

    return n;
  }

  var W = 1,
      R = 32,
      I = 1024;

  function P(e) {
    var _replace$replace$spli = (e + "").replace(/\s+/g, "").replace(/[,锛寈X]+/g, "x").split("x").map(Number),
        _replace$replace$spli2 = _slicedToArray(_replace$replace$spli, 3),
        t = _replace$replace$spli2[0],
        n = _replace$replace$spli2[1],
        r = _replace$replace$spli2[2];

    var s = 1 == t || 1 == n ? I : R,
        i = {
      x: O(t || W, 1, s),
      y: O(n || t || W, 1, s),
      z: O(r || W, 1, s)
    };
    return Object.assign({}, i, {
      count: i.x * i.y
    });
  }

  function U(e, t) {
    if (t) {
      var _n5 = new Blob([e], {
        type: "image/svg+xml"
      });

      return "url(".concat(URL.createObjectURL(_n5), "#").concat(t, ")");
    }

    return "url(\"data:image/svg+xml;utf8,".concat(encodeURIComponent(e), "\")");
  }

  function q(e) {
    var t = 'xmlns="http://www.w3.org/2000/svg"';
    return e.includes("<svg") || (e = "<svg ".concat(t, ">").concat(e, "</svg>")), e.includes("xmlns") || (e = e.replace(/<svg([\s>])/, "<svg ".concat(t, "$1"))), e;
  }

  function B() {
    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
    var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : e;
    return 1 == arguments.length && (e = e < 1 ? .1 : 1), function (e, t, n) {
      return e * (1 - n) + t * n;
    }(e, t, Math.random());
  }

  function D(e) {
    return function () {
      for (var _len2 = arguments.length, t = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        t[_key2] = arguments[_key2];
      }

      var n = function (e) {
        var t = "";
        return e.some(function (e) {
          var n = String(e).trim();
          if (!n) return "";
          var r = n.match(/\d(\D+)$/);
          return t = r ? r[1] : "";
        }), t;
      }(t);

      return function (e, t) {
        return function () {
          for (var _len3 = arguments.length, n = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
            n[_key3] = arguments[_key3];
          }

          n = n.map(function (e) {
            return Number(String(e).replace(/\D+$/g, ""));
          });
          var r = e.apply(null, n);
          return t.length ? Array.isArray(r) ? r.map(function (e) {
            return e + t;
          }) : r + t : r;
        };
      }(e, n).apply(null, t);
    };
  }

  function Z(e) {
    return function () {
      for (var _len4 = arguments.length, t = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
        t[_key4] = arguments[_key4];
      }

      var n = t.map(function (e) {
        return String(e).charCodeAt(0);
      }),
          r = e.apply(null, n);
      return Array.isArray(r) ? r.map(function (e) {
        return String.fromCharCode(e);
      }) : String.fromCharCode(r);
    };
  }

  function V(e) {
    var t = function (e) {
      var t = function (e) {
        var t = String(e),
            n = [],
            r = "";

        for (var _e9 = 0; _e9 < t.length; ++_e9) {
          var _i2 = t[_e9];
          if (X[_i2]) {
            if ("-" == _i2 && "e" == t[_e9 - 1]) r += _i2;else if (n.length || r.length || !/[+-]/.test(_i2)) {
              var _ref4 = s(n) || {},
                  _e10 = _ref4.type,
                  _t4 = _ref4.value;

              "operator" == _e10 && !r.length && /[^()]/.test(_i2) && /[^()]/.test(_t4) ? r += _i2 : (r.length && (n.push({
                type: "number",
                value: r
              }), r = ""), n.push({
                type: "operator",
                value: _i2
              }));
            } else r += _i2;
          } else /\S/.test(_i2) && (r += _i2);
        }

        r.length && n.push({
          type: "number",
          value: r
        });
        return n;
      }(e);

      var n = [],
          r = [];

      for (var _e11 = 0; _e11 < t.length; ++_e11) {
        var _t$_e = t[_e11],
            _i3 = _t$_e.type,
            _l = _t$_e.value;
        if ("number" == _i3) r.push(_l);else if ("operator" == _i3) if ("(" == _l) n.push(_l);else if (")" == _l) {
          for (; n.length && "(" != s(n);) {
            r.push(n.pop());
          }

          n.pop();
        } else {
          for (; n.length && X[s(n)] >= X[_l];) {
            var _e12 = n.pop();

            /[()]/.test(_e12) || r.push(_e12);
          }

          n.push(_l);
        }
      }

      for (; n.length;) {
        r.push(n.pop());
      }

      return r;
    }(e),
        n = [];

    for (; t.length;) {
      var _e13 = t.shift();

      if (/\d+/.test(_e13)) n.push(_e13);else {
        var _t5 = n.pop(),
            _r3 = n.pop();

        n.push(F(_e13, Number(_r3), Number(_t5)));
      }
    }

    return n[0];
  }

  var X = {
    "*": 3,
    "/": 3,
    "%": 3,
    "+": 2,
    "-": 2,
    "(": 1,
    ")": 1
  };

  function F(e, t, n) {
    switch (e) {
      case "+":
        return t + n;

      case "-":
        return t - n;

      case "*":
        return t * n;

      case "/":
        return t / n;

      case "%":
        return t % n;
    }
  }

  var G = {};

  function J(e, t) {
    return function () {
      for (var _len5 = arguments.length, n = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {
        n[_key5] = arguments[_key5];
      }

      var r = e + n.join("-");
      return G[r] ? G[r] : G[r] = t.apply(null, n);
    };
  }

  function K(e) {
    return function () {
      for (var _len6 = arguments.length, t = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {
        t[_key6] = arguments[_key6];
      }

      return e.apply(null, l(t, function (e) {
        return String(e).startsWith("[") ? Y(e) : e;
      }));
    };
  }

  function Q(e, t) {
    return {
      type: e,
      value: t
    };
  }

  var Y = J("build_range", function (e) {
    return l(function (e) {
      var t = String(e),
          n = [],
          r = [];
      if (!t.startsWith("[") || !t.endsWith("]")) return n;

      for (var _e14 = 1; _e14 < t.length - 1; ++_e14) {
        var _i4 = t[_e14];
        if ("-" != _i4 || "-" != t[_e14 - 1]) if ("-" != _i4) {
          if ("-" != s(r)) r.length && n.push(Q("char", r.pop())), r.push(_i4);else {
            r.pop();

            var _e15 = r.pop();

            n.push(_e15 ? Q("range", [_e15, _i4]) : Q("char", _i4));
          }
        } else r.push(_i4);
      }

      return r.length && n.push(Q("char", r.pop())), n;
    }(e), function (_ref5) {
      var _ref6;

      var e = _ref5.type,
          t = _ref5.value;
      if ("char" == e) return t;

      var _t6 = _slicedToArray(t, 2),
          n = _t6[0],
          r = _t6[1],
          s = !1;

      n > r && ((_ref6 = [r, n], n = _ref6[0], r = _ref6[1], _ref6), s = !0);
      var i = Z(L)(n, r);
      return s && i.reverse(), i;
    });
  }),
      ee = Math.cos,
      te = Math.sin,
      ne = Math.sqrt,
      re = Math.pow,
      se = Math.PI,
      ie = se / 180;

  function le(e, t) {
    "function" == typeof arguments[0] && (t = e, e = {}), t || (t = function t(e) {
      return [ee(e), te(e)];
    });
    var n = e.split || 120,
        r = e.scale || 1,
        s = ie * (e.start || 0),
        i = e.deg ? e.deg * ie : se / (n / 2),
        l = [];

    for (var _e16 = 0; _e16 < n; ++_e16) {
      var _n6 = s + i * _e16,
          _t7 = t(_n6),
          _t8 = _slicedToArray(_t7, 2),
          _u = _t8[0],
          _o = _t8[1];

      l.push(50 * _u * r + 50 + "% " + (50 * _o * r + 50) + "%");
    }

    return e.type ? "polygon(".concat(e.type, ", ").concat(l.join(","), ")") : "polygon(".concat(l.join(","), ")");
  }

  function ue(e, t, n) {
    var r = ie * n;
    return [e * ee(r) - t * te(r), t * ee(r) + e * te(r)];
  }

  var oe = {
    circle: function circle() {
      return "circle(49%)";
    },
    triangle: function triangle() {
      return le({
        split: 3,
        start: -90
      }, function (e) {
        return [1.1 * ee(e), 1.1 * te(e) + .2];
      });
    },
    rhombus: function rhombus() {
      return le({
        split: 4
      });
    },
    pentagon: function pentagon() {
      return le({
        split: 5,
        start: 54
      });
    },
    hexgon: function hexgon() {
      return le({
        split: 6,
        start: 30
      });
    },
    hexagon: function hexagon() {
      return le({
        split: 6,
        start: 30
      });
    },
    heptagon: function heptagon() {
      return le({
        split: 7,
        start: -90
      });
    },
    octagon: function octagon() {
      return le({
        split: 8,
        start: 22.5
      });
    },
    star: function star() {
      return le({
        split: 5,
        start: 54,
        deg: 144
      });
    },
    diamond: function diamond() {
      return "polygon(50% 5%, 80% 50%, 50% 95%, 20% 50%)";
    },
    cross: function cross() {
      return "polygon(\n 5% 35%, 35% 35%, 35% 5%, 65% 5%,\n 65% 35%, 95% 35%, 95% 65%, 65% 65%,\n 65% 95%, 35% 95%, 35% 65%, 5% 65%\n )";
    },
    clover: function clover() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 3;
      return 4 == (e = O(e, 3, 5)) && (e = 2), le({
        split: 240
      }, function (t) {
        var n = ee(e * t) * ee(t),
            r = ee(e * t) * te(t);
        return 3 == e && (n -= .2), 2 == e && (n /= 1.1, r /= 1.1), [n, r];
      });
    },
    hypocycloid: function hypocycloid() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 3;
      var t = 1 - (e = O(e, 3, 6));
      return le({
        scale: 1 / e
      }, function (n) {
        var r = t * ee(n) + ee(t * (n - se)),
            s = t * te(n) + te(t * (n - se));
        return 3 == e && (r = 1.1 * r - .6, s *= 1.1), [r, s];
      });
    },
    astroid: function astroid() {
      return oe.hypocycloid(4);
    },
    infinity: function infinity() {
      return le(function (e) {
        var t = .7 * ne(2) * ee(e),
            n = re(te(e), 2) + 1;
        return [t / n, t * te(e) / n];
      });
    },
    heart: function heart() {
      return le(function (e) {
        return ue(1.2 * (.75 * re(te(e), 3)), 1.1 * (ee(1 * e) * (13 / 18) - ee(2 * e) * (5 / 18) - ee(3 * e) / 18 - ee(4 * e) / 18 + .2), 180);
      });
    },
    bean: function bean() {
      return le(function (e) {
        var _ref7 = [re(te(e), 3), re(ee(e), 3)],
            t = _ref7[0],
            n = _ref7[1];
        return ue((t + n) * ee(e) * 1.3 - .45, (t + n) * te(e) * 1.3 - .45, -90);
      });
    },
    bicorn: function bicorn() {
      return le(function (e) {
        return ue(ee(e), re(te(e), 2) / (2 + te(e)) - .5, 180);
      });
    },
    pear: function pear() {
      return le(function (e) {
        return [te(e), (1 + te(e)) * ee(e) / 1.4];
      });
    },
    fish: function fish() {
      return le(function (e) {
        return [ee(e) - re(te(e), 2) / ne(2), te(2 * e) / 2];
      });
    },
    whale: function whale() {
      return le({
        split: 240
      }, function (e) {
        var t = 3.4 * (re(te(e), 2) - .5) * ee(e);
        return ue(ee(e) * t + .75, te(e) * t * 1.2, 180);
      });
    },
    bud: function bud() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 3;
      return e = O(e, 3, 10), le({
        split: 240
      }, function (t) {
        return [(1 + .2 * ee(e * t)) * ee(t) * .8, (1 + .2 * ee(e * t)) * te(t) * .8];
      });
    },
    alien: function alien() {
      for (var _len7 = arguments.length, e = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {
        e[_key7] = arguments[_key7];
      }

      var _e$map = e.map(function (e) {
        return O(e, 1, 9);
      }),
          _e$map2 = _slicedToArray(_e$map, 5),
          _e$map2$ = _e$map2[0],
          t = _e$map2$ === void 0 ? 1 : _e$map2$,
          _e$map2$2 = _e$map2[1],
          n = _e$map2$2 === void 0 ? 1 : _e$map2$2,
          _e$map2$3 = _e$map2[2],
          r = _e$map2$3 === void 0 ? 1 : _e$map2$3,
          _e$map2$4 = _e$map2[3],
          s = _e$map2$4 === void 0 ? 1 : _e$map2$4,
          _e$map2$5 = _e$map2[4],
          i = _e$map2$5 === void 0 ? 1 : _e$map2$5;

      return le({
        split: 480,
        type: "evenodd"
      }, function (e) {
        return [.31 * (ee(e * t) + ee(e * r) + ee(e * i)), .31 * (te(e * n) + te(e * s) + te(e))];
      });
    }
  },
      ae = {
    index: function index(_ref8) {
      var e = _ref8.count;
      return function (t) {
        return e;
      };
    },
    row: function row(_ref9) {
      var e = _ref9.x;
      return function (t) {
        return e;
      };
    },
    col: function col(_ref10) {
      var e = _ref10.y;
      return function (t) {
        return e;
      };
    },
    size: function size(_ref11) {
      var e = _ref11.grid;
      return function (t) {
        return e.count;
      };
    },
    "size-row": function sizeRow(_ref12) {
      var e = _ref12.grid;
      return function (t) {
        return e.x;
      };
    },
    "size-col": function sizeCol(_ref13) {
      var e = _ref13.grid;
      return function (t) {
        return e.y;
      };
    },
    n: function n(_ref14) {
      var e = _ref14.idx;
      return function (t) {
        return e || 0;
      };
    },
    pick: function pick(_ref15) {
      var e = _ref15.context;
      return K(function () {
        for (var _len8 = arguments.length, t = new Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {
          t[_key8] = arguments[_key8];
        }

        return e.last_pick = function () {
          for (var _len9 = arguments.length, e = new Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {
            e[_key9] = arguments[_key9];
          }

          var t = e.reduce(function (e, t) {
            return e.concat(t);
          }, []);
          return t[~~(Math.random() * t.length)];
        }(t);
      });
    },
    "pick-n": function pickN(_ref16) {
      var e = _ref16.idx,
          t = _ref16.context,
          n = _ref16.position;
      var r = "pn-counter" + n;
      return K(function () {
        t[r] || (t[r] = 0), t[r] += 1;
        var s = arguments.length,
            i = ((null == e ? t[r] : e) - 1) % s;
        return t.last_pick = i < 0 || arguments.length <= i ? undefined : arguments[i];
      });
    },
    "pick-d": function pickD(_ref17) {
      var e = _ref17.idx,
          t = _ref17.context,
          n = _ref17.position;
      var r = "pd-counter" + n,
          s = "pd-values" + n;
      return K(function () {
        for (var _len10 = arguments.length, n = new Array(_len10), _key10 = 0; _key10 < _len10; _key10++) {
          n[_key10] = arguments[_key10];
        }

        t[r] || (t[r] = 0), t[r] += 1, t[s] || (t[s] = function (e) {
          var t = Array.from ? Array.from(e) : e.slice(),
              n = e.length;

          for (; n;) {
            var _e17 = ~~(Math.random() * n--),
                _r4 = t[n];

            t[n] = t[_e17], t[_e17] = _r4;
          }

          return t;
        }(n));
        var i = n.length,
            l = ((null == e ? t[r] : e) - 1) % i;
        return t.last_pick = t[s][l];
      });
    },
    "last-pick": function lastPick(_ref18) {
      var e = _ref18.context;
      return function () {
        return e.last_pick;
      };
    },
    multiple: H(function (e, t) {
      if (!t || !e) return "";
      return N(O(e(), 0, 65536), function (e) {
        return t(e + 1);
      }).join(",");
    }),
    repeat: H(function (e, t) {
      if (!t || !e) return "";
      return N(O(e(), 0, 65536), function (e) {
        return t(e + 1);
      }).join("");
    }),
    rand: function rand(_ref19) {
      var e = _ref19.context;
      return function () {
        for (var _len11 = arguments.length, t = new Array(_len11), _key11 = 0; _key11 < _len11; _key11++) {
          t[_key11] = arguments[_key11];
        }

        var n = (t.every(T) ? Z : D)(B).apply(null, t);
        return e.last_rand = n;
      };
    },
    "rand-int": function randInt(_ref20) {
      var e = _ref20.context;
      return function () {
        for (var _len12 = arguments.length, t = new Array(_len12), _key12 = 0; _key12 < _len12; _key12++) {
          t[_key12] = arguments[_key12];
        }

        var n = t.every(T) ? Z : D,
            r = parseInt(n(B).apply(null, t));
        return e.last_rand = r;
      };
    },
    "last-rand": function lastRand(_ref21) {
      var e = _ref21.context;
      return function () {
        return e.last_rand;
      };
    },
    calc: function calc() {
      return function (e) {
        return V(e);
      };
    },
    hex: function hex() {
      return function (e) {
        return parseInt(e).toString(16);
      };
    },
    svg: H(function (e) {
      if (void 0 === e) return "";
      return U(q(e().trim()));
    }),
    "svg-filter": H(function (e) {
      if (void 0 === e) return "";

      var t = function () {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
        return e + Math.random().toString(32).substr(2);
      }("filter-");

      return U(q(e().trim()).replace(/<filter([\s>])/, "<filter id=\"".concat(t, "\"$1")), t);
    }),
    "var": function _var() {
      return function (e) {
        return "var(".concat(e, ")");
      };
    },
    shape: function shape() {
      return memo("shape-function", function () {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";

        for (var _len13 = arguments.length, t = new Array(_len13 > 1 ? _len13 - 1 : 0), _key13 = 1; _key13 < _len13; _key13++) {
          t[_key13 - 1] = arguments[_key13];
        }

        return e = e.trim(), "function" == typeof oe[e] ? oe[e](t) : "";
      });
    }
  };
  var ce,
      pe,
      he = (ce = ae, pe = {
    multi: "multiple",
    m: "multiple",
    pn: "pick-n",
    pd: "pick-d",
    r: "rand",
    ri: "rand-int",
    p: "pick",
    lp: "last-pick",
    lr: "last-rand",
    i: "index",
    "pick-by-turn": "pick-n",
    "max-row": "size-row",
    "max-col": "size-col"
  }, Object.keys(pe).forEach(function (e) {
    ce[e] = ce[pe[e]];
  }), ce);

  var fe = function fe(e) {
    return /[,锛孿s]/.test(e);
  };

  function de(e) {
    for (; !e.end() && fe(e.curr(1));) {
      e.next();
    }
  }

  function ge(t) {
    var n = e(t),
        r = [],
        s = [];
    var i = "";

    for (; !n.end();) {
      var _e18 = n.curr();

      "(" == _e18 ? (i += _e18, s.push(_e18)) : ")" == _e18 ? (i += _e18, s.length && s.pop()) : s.length ? i += _e18 : fe(_e18) ? (r.push(i), i = "", de(n)) : i += _e18, n.next();
    }

    return i && r.push(i), r;
  }

  var me = [];

  function ye(e) {
    if (!me.length) {
      var _e19 = new Set();

      for (var _t9 in document.head.style) {
        _t9.startsWith("-") || _e19.add(_t9.replace(/[A-Z]/g, "-$&").toLowerCase());
      }

      _e19.has("grid-gap") || _e19.add("grid-gap"), me = Array.from(_e19);
    }

    return e && e.test ? me.filter(function (t) {
      return e.test(t);
    }) : me;
  }

  function ve(e) {
    var t = new RegExp("\\-?".concat(e, "\\-?"));
    return ye(t).map(function (e) {
      return e.replace(t, "");
    }).reduce(function (e, t) {
      return e[t] = t, e;
    }, {});
  }

  var xe = ve("webkit"),
      _e = ve("moz");

  function be(e, t) {
    return xe[e] ? "-webkit-".concat(t).concat(t) : _e[e] ? "-moz-".concat(t).concat(t) : t;
  }

  var $e = {
    "@size": function size(e, _ref22) {
      var t = _ref22.is_special_selector;

      var _ge = ge(e),
          _ge2 = _slicedToArray(_ge, 2),
          n = _ge2[0],
          _ge2$ = _ge2[1],
          r = _ge2$ === void 0 ? n : _ge2$;

      return "\n width:".concat(n, ";height:").concat(r, ";").concat(t ? "" : "\n --internal-cell-width:".concat(n, ";--internal-cell-height:").concat(r, ";"));
    },
    "@min-size": function minSize(e) {
      var _ge3 = ge(e),
          _ge4 = _slicedToArray(_ge3, 2),
          t = _ge4[0],
          _ge4$ = _ge4[1],
          n = _ge4$ === void 0 ? t : _ge4$;

      return "min-width:".concat(t, ";min-height:").concat(n, ";");
    },
    "@max-size": function maxSize(e) {
      var _ge5 = ge(e),
          _ge6 = _slicedToArray(_ge5, 2),
          t = _ge6[0],
          _ge6$ = _ge6[1],
          n = _ge6$ === void 0 ? t : _ge6$;

      return "max-width:".concat(t, ";max-height:").concat(n, ";");
    },
    "@place-cell": function () {
      var e = {
        center: "50%",
        0: "0%",
        left: "0%",
        right: "100%",
        top: "50%",
        bottom: "50%"
      },
          t = {
        center: "50%",
        0: "0%",
        top: "0%",
        bottom: "100%",
        left: "50%",
        right: "50%"
      };
      return function (n) {
        var _ge7 = ge(n),
            _ge8 = _slicedToArray(_ge7, 2),
            r = _ge8[0],
            _ge8$ = _ge8[1],
            s = _ge8$ === void 0 ? "50%" : _ge8$;

        var i = "var(--internal-cell-width, 25%)",
            l = "var(--internal-cell-height, 25%)";
        return "\n position:absolute;left:".concat(r = e[r] || r, ";top:").concat(s = t[s] || s, ";width:").concat(i, ";height:").concat(l, ";margin-left:calc(").concat(i, "/ -2) !important;margin-top:calc(").concat(l, "/ -2) !important;grid-area:unset !important;");
      };
    }(),
    "@grid": function grid(e, t) {
      var _e$split$map = e.split("/").map(function (e) {
        return e.trim();
      }),
          _e$split$map2 = _slicedToArray(_e$split$map, 2),
          n = _e$split$map2[0],
          r = _e$split$map2[1];

      return {
        grid: P(n),
        size: r ? this["@size"](r, t) : ""
      };
    },
    "@shape": J("shape-property", function (e) {
      var _ge9 = ge(e),
          _ge10 = _toArray(_ge9),
          t = _ge10[0],
          n = _ge10.slice(1);

      return oe[t] ? be("clip-path", "clip-path:".concat(oe[t].apply(null, n), ";")) + "overflow:hidden;" : "";
    }),
    "@use": function use(e) {
      if (e.length > 2) return e;
    }
  };

  function ke(e, t, n) {
    var r = function (e) {
      return function (t) {
        return String(e).replace(/(\d+)(n)/g, "$1*" + t).replace(/n/g, t);
      };
    }(e);

    for (var _e20 = 0; _e20 <= n; ++_e20) {
      if (V(r(_e20)) == t) return !0;
    }
  }

  var we = {
    even: function even(e) {
      return !!(e % 2);
    },
    odd: function odd(e) {
      return !(e % 2);
    }
  };

  function ze(e) {
    return /^(even|odd)$/.test(e);
  }

  var je = {
    at: function at(_ref23) {
      var e = _ref23.x,
          t = _ref23.y;
      return function (n, r) {
        return e == n && t == r;
      };
    },
    nth: function nth(_ref24) {
      var e = _ref24.count,
          t = _ref24.grid;
      return function () {
        for (var _len14 = arguments.length, n = new Array(_len14), _key14 = 0; _key14 < _len14; _key14++) {
          n[_key14] = arguments[_key14];
        }

        return n.some(function (n) {
          return ze(n) ? we[n](e - 1) : ke(n, e, t.count);
        });
      };
    },
    row: function row(_ref25) {
      var e = _ref25.x,
          t = _ref25.grid;
      return function () {
        for (var _len15 = arguments.length, n = new Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {
          n[_key15] = arguments[_key15];
        }

        return n.some(function (n) {
          return ze(n) ? we[n](e - 1) : ke(n, e, t.x);
        });
      };
    },
    col: function col(_ref26) {
      var e = _ref26.y,
          t = _ref26.grid;
      return function () {
        for (var _len16 = arguments.length, n = new Array(_len16), _key16 = 0; _key16 < _len16; _key16++) {
          n[_key16] = arguments[_key16];
        }

        return n.some(function (n) {
          return ze(n) ? we[n](e - 1) : ke(n, e, t.y);
        });
      };
    },
    even: function even(_ref27) {
      var e = _ref27.count;
      return function (t) {
        return we.even(e - 1);
      };
    },
    odd: function odd(_ref28) {
      var e = _ref28.count;
      return function (t) {
        return we.odd(e - 1);
      };
    },
    random: function random() {
      return function () {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : .5;
        return e >= 1 && e <= 0 && (e = .5), Math.random() < e;
      };
    }
  };
  var Ae = Object.getOwnPropertyNames(Math).reduce(function (e, t) {
    return e[t] = function () {
      return function () {
        for (var _len17 = arguments.length, e = new Array(_len17), _key17 = 0; _key17 < _len17; _key17++) {
          e[_key17] = arguments[_key17];
        }

        return "number" == typeof Math[t] ? Math[t] : Math[t].apply(null, e.map(V));
      };
    }, e;
  }, {});

  function Me(e) {
    return /^\:(host|doodle)/.test(e);
  }

  function Se(e) {
    return /^\:(container|parent)/.test(e);
  }

  function Ee(e) {
    return Me(e) || Se(e);
  }

  var Ce =
  /*#__PURE__*/
  function () {
    function Ce(e) {
      _classCallCheck(this, Ce);

      this.tokens = e, this.rules = {}, this.props = {}, this.keyframes = {}, this.grid = null, this.coords = [], this.reset();
    }

    _createClass(Ce, [{
      key: "reset",
      value: function reset() {
        this.styles = {
          host: "",
          container: "",
          cells: "",
          keyframes: ""
        }, this.coords = [];

        for (var _e21 in this.rules) {
          _e21.startsWith("[cell]") && delete this.rules[_e21];
        }
      }
    }, {
      key: "add_rule",
      value: function add_rule(e, t) {
        var r = this.rules[e];
        r || (r = this.rules[e] = []), r.push.apply(r, n(t));
      }
    }, {
      key: "pick_func",
      value: function pick_func(e) {
        return he[e] || Ae[e];
      }
    }, {
      key: "compose_aname",
      value: function compose_aname() {
        for (var _len18 = arguments.length, e = new Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {
          e[_key18] = arguments[_key18];
        }

        return e.join("-");
      }
    }, {
      key: "compose_selector",
      value: function compose_selector(e) {
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "";
        return "[cell]:nth-of-type(".concat(e, ")").concat(t);
      }
    }, {
      key: "compose_argument",
      value: function compose_argument(e, t, n) {
        var _this = this;

        var r = e.map(function (e) {
          if ("text" == e.type) return e.value;

          if ("func" == e.type) {
            var _r5 = _this.pick_func(e.name.substr(1));

            if (_r5) {
              t.idx = n, t.position = e.position;

              var _s2 = e.arguments.map(function (e) {
                return _r5.lazy ? function (n) {
                  return _this.compose_argument(e, t, n);
                } : _this.compose_argument(e, t, n);
              });

              return C(_r5, t, _s2);
            }
          }
        });
        return r.length >= 2 ? r.join("") : r[0];
      }
    }, {
      key: "compose_value",
      value: function compose_value(e, t) {
        var _this2 = this;

        return e && e.reduce ? e.reduce(function (e, n) {
          switch (n.type) {
            case "text":
              e += n.value;
              break;

            case "func":
              {
                var _r6 = n.name.substr(1),
                    _s3 = _this2.pick_func(_r6);

                if (_s3) {
                  t.position = n.position;

                  var _r7 = n.arguments.map(function (e) {
                    return _s3.lazy ? function (n) {
                      return _this2.compose_argument(e, t, n);
                    } : _this2.compose_argument(e, t);
                  });

                  e += C(_s3, t, _r7);
                }
              }
          }

          return e;
        }, "") : "";
      }
    }, {
      key: "compose_rule",
      value: function compose_rule(e, t, n) {
        var _this3 = this;

        var r = Object.assign({}, t),
            s = e.property,
            i = e.value.reduce(function (e, t) {
          var n = _this3.compose_value(t, r);

          return n && e.push(n), e;
        }, []),
            l = i.join(", ");

        if (/^animation(\-name)?$/.test(s) && (this.props.has_animation = !0, r.count > 1)) {
          var _e22 = r.count;

          switch (s) {
            case "animation-name":
              l = i.map(function (t) {
                return _this3.compose_aname(t, _e22);
              }).join(", ");
              break;

            case "animation":
              l = i.map(function (t) {
                var n = (t || "").split(/\s+/);
                return n[0] = _this3.compose_aname(n[0], _e22), n.join(" ");
              }).join(", ");
          }
        }

        "content" == s && (/["']|^(none|var|counter|counters|attr)\(/.test(l) || (l = "'".concat(l, "'"))), "transition" == s && (this.props.has_transition = !0);
        var u = "".concat(s, ":").concat(l, ";");

        if (u = be(s, u), "clip-path" == s && (u += ";overflow:hidden;"), "width" != s && "height" != s || Ee(n) || (u += "--internal-cell-".concat(s, ":").concat(l, ";")), $e[s]) {
          var _t10 = $e[s](l, {
            is_special_selector: Ee(n)
          });

          switch (s) {
            case "@grid":
              Me(n) && (this.grid = _t10.grid, u = _t10.size || "");
              break;

            case "@place-cell":
              Me(n) || (u = _t10);

            case "@use":
              e.value.length && this.compose(r, e.value), u = $e[s](e.value);

            default:
              u = _t10;
          }
        }

        return u;
      }
    }, {
      key: "compose",
      value: function compose(e, t) {
        var _this4 = this;

        this.coords.push(e), (t || this.tokens).forEach(function (t, n) {
          if (t.skip) return !1;

          switch (t.type) {
            case "rule":
              _this4.add_rule(_this4.compose_selector(e.count), _this4.compose_rule(t, e));

              break;

            case "pseudo":
              {
                t.selector.startsWith(":doodle") && (t.selector = t.selector.replace(/^\:+doodle/, ":host"));

                var _n7 = Ee(t.selector);

                _n7 && (t.skip = !0), t.selector.split(",").forEach(function (r) {
                  var s = t.styles.map(function (t) {
                    return _this4.compose_rule(t, e, r);
                  }),
                      i = _n7 ? r : _this4.compose_selector(e.count, r);

                  _this4.add_rule(i, s);
                });
                break;
              }

            case "cond":
              {
                var _n8 = je[t.name.substr(1)];

                if (_n8) {
                  var _r8 = t.arguments.map(function (t) {
                    return _this4.compose_argument(t, e);
                  });

                  C(_n8, e, _r8) && _this4.compose(e, t.styles);
                }

                break;
              }

            case "keyframes":
              _this4.keyframes[t.name] || (_this4.keyframes[t.name] = function (e) {
                return "\n ".concat(r(t.steps.map(function (t) {
                  return "\n ".concat(t.name, "{").concat(r(t.styles.map(function (t) {
                    return _this4.compose_rule(t, e);
                  })), "}");
                })));
              });
          }
        });
      }
    }, {
      key: "output",
      value: function output() {
        var _this5 = this;

        Object.keys(this.rules).forEach(function (e, t) {
          if (Se(e)) _this5.styles.container += "\n .container{".concat(r(_this5.rules[e]), "}");else {
            var _t11 = Me(e) ? "host" : "cells";

            _this5.styles[_t11] += "\n ".concat(e, "{").concat(r(_this5.rules[e]), "}");
          }
        });
        var e = Object.keys(this.keyframes);
        return this.coords.forEach(function (t, n) {
          e.forEach(function (e) {
            var r = _this5.compose_aname(e, t.count);

            _this5.styles.keyframes += "\n ".concat(function (e, t) {
              return e ? "function" == typeof t ? t() : t : "";
            }(0 == n, "@keyframes ".concat(e, "{").concat(_this5.keyframes[e](t), "}")), "@keyframes ").concat(r, "{").concat(_this5.keyframes[e](t), "}");
          });
        }), {
          props: this.props,
          styles: this.styles,
          grid: this.grid
        };
      }
    }]);

    return Ce;
  }();

  function Oe(e, t) {
    var n = new Ce(e),
        r = {};
    n.compose({
      x: 1,
      y: 1,
      count: 1,
      context: {},
      grid: {
        x: 1,
        y: 1,
        count: 1
      }
    });

    var _n$output = n.output(),
        s = _n$output.grid;

    s && (t = s), n.reset();

    for (var _e23 = 1, _s4 = 0; _e23 <= t.x; ++_e23) {
      for (var _i5 = 1; _i5 <= t.y; ++_i5) {
        n.compose({
          x: _e23,
          y: _i5,
          count: ++_s4,
          grid: t,
          context: r
        });
      }
    }

    return n.output();
  }

  customElements.define("css-doodle",
  /*#__PURE__*/
  function (_HTMLElement) {
    _inherits(_class, _HTMLElement);

    function _class() {
      var _this6;

      _classCallCheck(this, _class);

      _this6 = _possibleConstructorReturn(this, _getPrototypeOf(_class).call(this)), _this6.doodle = _this6.attachShadow({
        mode: "open"
      }), _this6.extra = {
        get_custom_property_value: _this6.get_custom_property_value.bind(_assertThisInitialized(_this6))
      };
      return _this6;
    }

    _createClass(_class, [{
      key: "connectedCallback",
      value: function connectedCallback() {
        var _this7 = this;

        setTimeout(function () {
          var e,
              t = _this7.getAttribute("use") || "";
          if (t && (t = "@use:".concat(t, ";")), !_this7.innerHTML.trim() && !t) return !1;

          try {
            var _n9 = E(t + _this7.innerHTML, _this7.extra);

            _this7.grid_size = P(_this7.getAttribute("grid")), (e = Oe(_n9, _this7.grid_size)).grid && (_this7.grid_size = e.grid), _this7.build_grid(e);
          } catch (e) {
            _this7.innerHTML = "", console.error(e && e.message || "Error in css-doodle.");
          }
        });
      }
    }, {
      key: "get_custom_property_value",
      value: function get_custom_property_value(e) {
        return getComputedStyle(this).getPropertyValue(e).trim().replace(/^\(|\)$/g, "");
      }
    }, {
      key: "build_grid",
      value: function build_grid(e) {
        var _this8 = this;

        var _e$props = e.props,
            t = _e$props.has_transition,
            n = _e$props.has_animation,
            _e$styles = e.styles,
            r = _e$styles.keyframes,
            s = _e$styles.host,
            i = _e$styles.container,
            l = _e$styles.cells;
        this.doodle.innerHTML = "\n<style>".concat(this.style_basic(), "</style><style class=\"style-keyframes\">").concat(r, "</style><style class=\"style-container\">").concat(this.style_size()).concat(s).concat(i, "</style><style class=\"style-cells\">").concat(t || n ? "" : l, "</style><div class=\"container\">").concat(this.html_cells(), "</div>"), (t || n) && setTimeout(function () {
          _this8.set_style(".style-cells", l);
        }, 50);
      }
    }, {
      key: "inherit_props",
      value: function inherit_props(e) {
        return ye(/grid/).map(function (e) {
          return "".concat(e, ":inherit;");
        }).join("");
      }
    }, {
      key: "style_basic",
      value: function style_basic() {
        return "\n:host{display:block;visibility:visible;width:1em;height:1em;}.container, [cell]:not(:empty){position:relative;width:100%;height:100%;display:grid;".concat(this.inherit_props(), "}[cell]:empty{position:relative;line-height:1;box-sizing:border-box;display:flex;justify-content:center;align-items:center;}");
      }
    }, {
      key: "style_size",
      value: function style_size() {
        var _this$grid_size = this.grid_size,
            e = _this$grid_size.x,
            t = _this$grid_size.y;
        return "\n:host{grid-template-rows:repeat(".concat(e, ", 1fr);grid-template-columns:repeat(").concat(t, ", 1fr);}");
      }
    }, {
      key: "html_cells",
      value: function html_cells() {
        var e = "<div cell></div>",
            t = e.repeat(this.grid_size.count),
            n = this.grid_size.z;

        for (; n--;) {
          e = e.replace(/<div\scell><\/div>/g, "<div cell>" + t + "</div>");
        }

        return e.replace(/^<div\scell>|<\/div>$/g, "");
      }
    }, {
      key: "set_style",
      value: function set_style(e, t) {
        var n = this.shadowRoot.querySelector(e);
        n && (n.styleSheet ? n.styleSheet.cssText = t : n.innerHTML = t);
      }
    }, {
      key: "update",
      value: function update(e) {
        var t = this.getAttribute("use") || "";
        t && (t = "@use:".concat(t, ";")), e || (e = this.innerHTML), this.innerHTML = e, this.grid_size || (this.grid_size = P(this.getAttribute("grid")));
        var n = Oe(E(t + e, this.extra), this.grid_size);

        if (n.grid) {
          var _n$grid = n.grid,
              _e24 = _n$grid.x,
              _t12 = _n$grid.y,
              _r9 = _n$grid.z,
              _this$grid_size2 = this.grid_size,
              _s5 = _this$grid_size2.x,
              _i6 = _this$grid_size2.y,
              _l2 = _this$grid_size2.z;
          if (_s5 !== _e24 || _i6 !== _t12 || _l2 !== _r9) return Object.assign(this.grid_size, n.grid), this.build_grid(n);
          Object.assign(this.grid_size, n.grid);
        } else {
          var _n10 = P(this.getAttribute("grid")),
              _r10 = _n10.x,
              _s6 = _n10.y,
              _i7 = _n10.z,
              _this$grid_size3 = this.grid_size,
              _l3 = _this$grid_size3.x,
              _u2 = _this$grid_size3.y,
              _o2 = _this$grid_size3.z;

          if (_l3 !== _r10 || _u2 !== _s6 || _o2 !== _i7) return Object.assign(this.grid_size, _n10), this.build_grid(Oe(E(t + e, this.extra), this.grid_size));
        }

        this.set_style(".style-keyframes", n.styles.keyframes), this.set_style(".style-container", this.style_size() + n.styles.host + n.styles.container), this.set_style(".style-cells", n.styles.cells);
      }
    }, {
      key: "attributeChangedCallback",
      value: function attributeChangedCallback(e, t, n) {
        if (t == n) return !1;
        "grid" == e && t && (this.grid = n), "use" == e && t && (this.use = n);
      }
    }, {
      key: "grid",
      get: function get() {
        return Object.assign({}, this.grid_size);
      },
      set: function set(e) {
        this.setAttribute("grid", e), this.connectedCallback();
      }
    }, {
      key: "use",
      get: function get() {
        return this.getAttribute("use");
      },
      set: function set(e) {
        this.setAttribute("use", e), this.connectedCallback();
      }
    }], [{
      key: "observedAttributes",
      get: function get() {
        return ["grid", "use"];
      }
    }]);

    return _class;
  }(_wrapNativeSuper(HTMLElement)));
});